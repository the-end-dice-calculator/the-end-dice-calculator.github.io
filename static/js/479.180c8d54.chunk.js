(()=>{"use strict";const e=function(e){return{...e,...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}};function*n(e){const t=[[1],[2],[3],[4],[5],[6]];if(e<=0)return[];if(1===e)yield*t;else for(let o of n(e-1))yield*t.map((e=>e.concat(o)))}const t=[1,6,36,216,1296,7776,6**6,6**7,6**8,6**9,6**10],o=e=>{const n=Object.values(e).reduce(((e,n)=>e+n),0);((e,n)=>{for(let i of t)if(o=e,r=i,Math.abs(o-r)<.1)return;var o,r;console.error("Sanity check failed, normalize denom is ".concat(e,". Expected a power of six between 1 and 6^10.")),console.error(n)})(n,e);return Object.fromEntries(Object.entries(e).map((e=>{let[t,o]=e;return[t,o/n]})))},r=(e,n)=>e.map((e=>e===n)).filter(Boolean).length,i=(e,n)=>e.map(((e,t)=>e===n?t:null)).filter((e=>null!=e));const c=t=>{const c={BRUTAL_CRIT:0,CRIT:0,BRUTAL_HIT:0,HIT:0,MISS:0},R=function(t,o){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(t.rapid_fire){const r=i(o,1).filter((e=>!T.includes(e)));if(r.length){const i=1/6**r.length;for(let c of function*(e,t){const o=n(t.length);for(let n of o)yield e.map(((e,o)=>t.includes(o)?n[t.indexOf(o)]:e))}(o,r))R(e(t,{rapid_fire:!1}),c,T.concat(r),s*i);return}}if(t.precise&&1===r(o,2)&&0===r(o,1)&&(t=e(t,{precise:!1}),o[o.indexOf(2)]+=1),t.brutal&&(o.includes(1)||o.includes(2))){const n=((e,n)=>{const t=i(e,1),o=i(e,2);for(let r of t.concat(o))if(!n.includes(r))return r;return-1})(o,T);if(n>=0)return void[1,2,3,4,5,6].forEach((r=>{const i=o.map(((e,t)=>t===n?r:e));R(e(t,{brutal:!1}),i,T.concat(n),s/6)}))}t.precise&&(t=e(t,{precise:!1}),o[o.indexOf(Math.min(...o))]+=1);const I=((e,n)=>Math.min(...e)<3?"MISS":Math.min(...e)<6?n?"BRUTAL_HIT":"HIT":n?"BRUTAL_CRIT":"CRIT")(o,t.brutal&&0===T.length);c[I]+=s};for(let e of n((e=>1+e.injuries+(e.long_shot?1:0)+(e.moving?1:0)+(e.cover?1:0)+(e.target_running?1:0))(t)))R(t,e);return o(c)},R=e=>{const t={COVER:0,ARMOR:0,HIT:0},r=n(3);for(let n of r){let o=0,r=e.scoped;if(e.cover&&n[o++]>=5){if(!r){t.COVER+=1;continue}if(r=!1,n[o++]>=5){t.COVER+=1;continue}}if(e.armor&&e.armor<7){const i=e.armor+(e.armor_penetration?1:0);if(n[o++]>=i){if(!r){t.ARMOR+=1;continue}if(r=!1,n[o++]>=i){t.ARMOR+=1;continue}}}t.HIT+=1}return o(t)},T=e=>{const t={COVER:0,ARMOR:0,DOUBLE_ARMOR:0,HIT:0,ARMOR_AND_HIT:0,DOUBLE_HIT:0},r=n(5);let i,c;const R=()=>Math.max(i,c)+1;for(let n of r){i=0,c=1;let o=!1,r=e.scoped;if(e.cover){const e=[n[i],n[c]];if(i=R(),c=R(),r){const t=e.findIndex((e=>e>=5));t>=0&&(e[t]=n[i],i=R(),r=!1)}if(e.every((e=>e>=5))){t.COVER+=1;continue}e.some((e=>e>=5))&&(o=!0)}if(e.armor&&e.armor<7){const T=e.armor+(e.armor_penetration?1:0);if(o){let e=n[i];if(i=R(),r&&e>=T&&(e=n[i],i=R()),e>=T){t.ARMOR+=1;continue}t.HIT+=1;continue}{const e=[n[i],n[c]];if(i=R(),c=R(),r){const t=e.findIndex((e=>e>=T));t>=0&&(e[t]=n[i],i=R(),r=!1)}if(e.every((e=>e>=T))){t.DOUBLE_ARMOR+=1;continue}if(e.some((e=>e>=T))){t.ARMOR_AND_HIT+=1;continue}t.DOUBLE_HIT+=1;continue}}o?t.HIT+=1:t.DOUBLE_HIT+=1}return o(t)},s=n=>n.brutal?(n=>{const t=c(n),o=R(n),r=n.cover?R(e(n,{cover:!1})):o,i=T(n),s=n.cover?T(e(n,{cover:!1})):i;return f=o,a=r,u=i,l=s,{KILL:(I=t).BRUTAL_CRIT*l.DOUBLE_HIT+I.BRUTAL_CRIT*l.ARMOR_AND_HIT+I.CRIT*a.HIT,BRUTAL_HIT:I.BRUTAL_HIT*u.DOUBLE_HIT,HIT:I.HIT*f.HIT+I.BRUTAL_HIT*u.HIT,HIT_AND_ARMOR_BREAK:I.BRUTAL_HIT*u.ARMOR_AND_HIT,ARMOR_BREAK:I.HIT*f.ARMOR+I.CRIT*a.ARMOR+I.BRUTAL_HIT*u.ARMOR,DOUBLE_ARMOR_BREAK:I.BRUTAL_HIT*u.DOUBLE_ARMOR+I.BRUTAL_CRIT*l.DOUBLE_ARMOR,MISS:I.MISS+I.HIT*f.COVER+I.BRUTAL_HIT*u.COVER};var I,f,a,u,l})(n):(n=>{const t=c(n),o=R(n),r=n.cover?R(e(n,{cover:!1})):o;return T=o,s=r,{KILL:(i=t).CRIT*s.HIT,HIT:i.HIT*T.HIT,ARMOR_BREAK:i.HIT*T.ARMOR+i.CRIT*s.ARMOR,MISS:i.MISS+i.HIT*T.COVER};var i,T,s})(n);onmessage=function(e){const n=s(e.data.circumstances);postMessage({requestTime:e.data.requestTime,output:n})}})();
//# sourceMappingURL=479.180c8d54.chunk.js.map