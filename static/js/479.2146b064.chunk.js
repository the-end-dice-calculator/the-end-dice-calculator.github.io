(()=>{"use strict";const e=function(e){return{...e,...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}};function*n(e){const r=[[1],[2],[3],[4],[5],[6]];if(e<=0)return[];if(1===e)yield*r;else for(let i of n(e-1))yield*r.map((e=>e.concat(i)))}const r=[1,6,36,216,1296,7776,6**6,6**7,6**8,6**9,6**10],i=e=>{const n=Object.values(e).reduce(((e,n)=>e+n),0);((e,n)=>{for(let o of r)if(i=e,t=o,Math.abs(i-t)<.1)return;var i,t;console.error("Sanity check failed, normalize denom is ".concat(e,". Expected a power of six between 1 and 6^10.")),console.error(n)})(n,e);return Object.fromEntries(Object.entries(e).map((e=>{let[r,i]=e;return[r,i/n]})))},t=(e,n)=>e.map((e=>e===n)).filter(Boolean).length,o=(e,n)=>e.map(((e,r)=>e===n?r:null)).filter((e=>null!=e));const c=r=>{const c={BRUTAL_CRIT:0,CRIT:0,BRUTAL_HIT:0,HIT:0,MISS:0},R=function(r,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(r.rapid_fire){const t=o(i,1).filter((e=>!I.includes(e)));if(t.length){const o=1/6**t.length;for(let c of function*(e,r){const i=n(r.length);for(let n of i)yield e.map(((e,i)=>r.includes(i)?n[r.indexOf(i)]:e))}(i,t))R(e(r,{rapid_fire:!1}),c,!0,I.concat(t),T*o);return}}if(r.precise&&1===t(i,2)&&0===t(i,1)&&(r=e(r,{precise:!1}),i[i.indexOf(2)]+=1,s=!0),r.brutal&&(i.includes(1)||i.includes(2))){const n=((e,n)=>{const r=o(e,1),i=o(e,2);for(let t of r.concat(i))if(!n.includes(t))return t;return-1})(i,I);if(n>=0)return void[1,2,3,4,5,6].forEach((t=>{const o=i.map(((e,r)=>r===n?t:e));R(e(r,{brutal:!1}),o,!0,I.concat(n),T/6)}))}r.precise&&(1===t(i,2)&&0===t(i,1)||1===t(i,5)&&t(i,6)===i.length-1)&&(r=e(r,{precise:!1}),i[i.indexOf(Math.min(...i))]+=1,s=!0);const f=((e,n)=>Math.min(...e)<3?"MISS":Math.min(...e)<6?n?"BRUTAL_HIT":"HIT":n?"BRUTAL_CRIT":"CRIT")(i,r.brutal&&!s&&0===I.length);c[f]+=T};for(let e of n((e=>1+e.injuries+(e.long_shot?1:0)+(e.moving?1:0)+(e.cover?1:0)+(e.target_running?1:0))(r)))R(r,e);return i(c)},R=r=>{const t={COVER:0,ARMOR:0,HIT:0},o=(n,r)=>{let i=0;if(n.cover){const t=5;let o=r[i++];if(n.piercing&&o===t&&(n=e(n,{piercing:!1}),o-=1),n.scoped&&o>=t&&(n=e(n,{scoped:!1}),o=r[i++]),n.piercing&&o>=t&&(n=e(n,{piercing:!1}),o-=1),o>=t)return"COVER"}if(n.armor&&n.armor<7){const t=n.armor;let o=r[i++];if(n.piercing&&o===t&&(n=e(n,{piercing:!1}),o-=1),n.scoped&&o>=t&&(n=e(n,{scoped:!1}),o=r[i++]),n.piercing&&o>=t&&(n=e(n,{piercing:!1}),o-=1),o>=t)return"ARMOR"}return"HIT"},c=n(3);for(let e of c)t[o(r,e)]+=1;return i(t)},s=r=>{const t={COVER:0,ARMOR:0,DOUBLE_ARMOR:0,HIT:0,ARMOR_AND_HIT:0,DOUBLE_HIT:0},o=(n,r)=>{let i=0,t=1;const o=()=>Math.max(i,t)+1;let c=!1;if(n.cover){const R=5,s=[r[i],r[t]];if(i=o(),t=o(),n.piercing&&s.some((e=>e===R))){n=e(n,{piercing:!1});const r=s.findIndex((e=>e===R));s[r]-=1}if(n.scoped&&s.some((e=>e>=R))){n=e(n,{scoped:!1});const t=s.findIndex((e=>e>=R));s[t]=r[i],i=o()}if(n.piercing&&s.some((e=>e>=R))){n=e(n,{piercing:!1});let r=s.findIndex((e=>e===R));-1===r&&(r=s.findIndex((e=>e>=R))),s[r]-=1}if(s.every((e=>e>=R)))return"COVER";s.some((e=>e>=R))&&(c=!0)}if(n.armor&&n.armor<7){const R=n.armor;if(c){let t=r[i];return i=o(),n.piercing&&t===R&&(n=e(n,{piercing:!1}),t-=1),n.scoped&&t>=R&&(n=e(n,{scoped:!1}),t=r[i],i=o()),n.piercing&&t>=R&&(n=e(n,{piercing:!1}),t-=1),t>=R?"ARMOR":"HIT"}{const c=[r[i],r[t]];if(i=o(),t=o(),n.piercing&&c.some((e=>e===R))){n=e(n,{piercing:!1});const r=c.findIndex((e=>e===R));c[r]-=1}if(n.scoped&&c.some((e=>e>=R))){n=e(n,{scoped:!1});const t=c.findIndex((e=>e>=R));c[t]=r[i],i=o()}if(n.piercing&&c.some((e=>e>=R))){n=e(n,{piercing:!1});let r=c.findIndex((e=>e===R));-1===r&&(r=c.findIndex((e=>e>=R))),c[r]-=1}return c.every((e=>e>=R))?"DOUBLE_ARMOR":c.some((e=>e>=R))?"ARMOR_AND_HIT":"DOUBLE_HIT"}}return c?"HIT":"DOUBLE_HIT"},c=n(5);for(let e of c)t[o(r,e)]+=1;return i(t)},I=n=>n.brutal?(n=>{const r=c(n),i=R(n),t=n.cover?R(e(n,{cover:!1})):i,o=s(n),I=n.cover?s(e(n,{cover:!1})):o;return f=i,l=t,d=o,a=I,{KILL:(T=r).BRUTAL_CRIT*a.DOUBLE_HIT+T.BRUTAL_CRIT*a.ARMOR_AND_HIT+T.CRIT*l.HIT,BRUTAL_HIT:T.BRUTAL_HIT*d.DOUBLE_HIT,HIT:T.HIT*f.HIT+T.BRUTAL_HIT*d.HIT,HIT_AND_ARMOR_BREAK:T.BRUTAL_HIT*d.ARMOR_AND_HIT,ARMOR_BREAK:T.HIT*f.ARMOR+T.CRIT*l.ARMOR+T.BRUTAL_HIT*d.ARMOR,DOUBLE_ARMOR_BREAK:T.BRUTAL_HIT*d.DOUBLE_ARMOR+T.BRUTAL_CRIT*a.DOUBLE_ARMOR,MISS:T.MISS+T.HIT*f.COVER+T.BRUTAL_HIT*d.COVER};var T,f,l,d,a})(n):(n=>{const r=c(n),i=R(n),t=n.cover?R(e(n,{cover:!1})):i;return s=i,I=t,{KILL:(o=r).CRIT*I.HIT,HIT:o.HIT*s.HIT,ARMOR_BREAK:o.HIT*s.ARMOR+o.CRIT*I.ARMOR,MISS:o.MISS+o.HIT*s.COVER};var o,s,I})(n);onmessage=function(e){const n=I(e.data.circumstances);postMessage({requestTime:e.data.requestTime,output:n})}})();
//# sourceMappingURL=479.2146b064.chunk.js.map