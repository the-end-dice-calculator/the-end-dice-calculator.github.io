(()=>{"use strict";const e=function(e){return{...e,...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}};function*n(e){const o=[[1],[2],[3],[4],[5],[6]];if(e<=0)return[];if(1===e)yield*o;else for(let t of n(e-1))yield*o.map((e=>e.concat(t)))}const o=[1,6,36,216,1296,7776,6**6,6**7,6**8,6**9,6**10],t=e=>{const n=Object.values(e).reduce(((e,n)=>e+n),0);((e,n)=>{for(let i of o)if(t=e,r=i,Math.abs(t-r)<.1)return;var t,r;console.error("Sanity check failed, normalize denom is ".concat(e,". Expected a power of six between 1 and 6^10.")),console.error(n)})(n,e);return Object.fromEntries(Object.entries(e).map((e=>{let[o,t]=e;return[o,t/n]})))},r=(e,n)=>e.map((e=>e===n)).filter(Boolean).length,i=(e,n)=>e.map(((e,o)=>e===n?o:null)).filter((e=>null!=e));const c=o=>{const c={BRUTAL_CRIT:0,CRIT:0,BRUTAL_HIT:0,HIT:0,MISS:0},R=function(o,t){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(o.rapid_fire){const r=i(t,1).filter((e=>!T.includes(e)));if(r.length){const i=1/6**r.length;for(let c of function*(e,o){const t=n(o.length);for(let n of t)yield e.map(((e,t)=>o.includes(t)?n[o.indexOf(t)]:e))}(t,r))R(e(o,{rapid_fire:!1}),c,T.concat(r),s*i);return}}if(o.precise&&1===r(t,2)&&0===r(t,1)&&(o=e(o,{precise:!1}),t[t.indexOf(2)]+=1),o.brutal&&(t.includes(1)||t.includes(2))){const n=((e,n)=>{const o=i(e,1),t=i(e,2);for(let r of o.concat(t))if(!n.includes(r))return r;return-1})(t,T);if(n>=0)return void[1,2,3,4,5,6].forEach((r=>{const i=t.map(((e,o)=>o===n?r:e));R(e(o,{brutal:!1}),i,T.concat(n),s/6)}))}o.precise&&(o=e(o,{precise:!1}),t[t.indexOf(Math.min(...t))]+=1);const I=((e,n)=>Math.min(...e)<3?"MISS":Math.min(...e)<6?n?"BRUTAL_HIT":"HIT":n?"BRUTAL_CRIT":"CRIT")(t,o.brutal&&0===T.length);c[I]+=s};for(let e of n((e=>1+e.injuries+(e.long_shot?1:0)+(e.moving?1:0)+(e.cover?1:0)+(e.target_running?1:0))(o)))R(o,e);return t(c)},R=e=>{const o={COVER:0,ARMOR:0,HIT:0},r=n(3);for(let n of r){let t=0,r=e.scoped;if(e.cover&&n[t++]>=5){if(!r){o.COVER+=1;continue}if(r=!1,n[t++]>=5){o.COVER+=1;continue}}if(e.armor&&e.armor<7){const i=e.armor+(e.armor_penetration?1:0);if(n[t++]>=i){if(!r){o.ARMOR+=1;continue}if(r=!1,n[t++]>=i){o.ARMOR+=1;continue}}}o.HIT+=1}return t(o)},T=e=>{const o={COVER:0,ARMOR:0,DOUBLE_ARMOR:0,HIT:0,ARMOR_AND_HIT:0,DOUBLE_HIT:0},r=n(5);let i,c;const R=()=>Math.max(i,c)+1;for(let n of r){i=0,c=1;let t=!1,r=e.scoped;if(e.cover){const e=[n[i],n[c]];if(i=R(),c=R(),r){const o=e.findIndex((e=>e>=5));o>=0&&(e[o]=n[i],i=R(),r=!1)}if(e.every((e=>e>=5))){o.COVER+=1;continue}e.some((e=>e>=5))&&(t=!0)}if(e.armor&&e.armor<7){const T=e.armor+(e.armor_penetration?1:0);if(t){let e=n[i];if(i=R(),r&&e>=T&&(e=n[i],i=R()),e>=T){o.ARMOR+=1;continue}o.HIT+=1;continue}{const e=[n[i],n[c]];if(i=R(),c=R(),r){const o=e.findIndex((e=>e>=T));o>=0&&(e[o]=n[i],i=R(),r=!1)}if(e.every((e=>e>=T))){o.DOUBLE_ARMOR+=1;continue}if(e.some((e=>e>=T))){o.ARMOR_AND_HIT+=1;continue}o.DOUBLE_HIT+=1;continue}}t?o.HIT+=1:o.DOUBLE_HIT+=1}return t(o)},s=n=>n.brutal?(n=>{const o=c(n),t=R(n),r=n.cover?R(e(n,{cover:!1})):t,i=T(n),s=n.cover?T(e(n,{cover:!1})):i;return a=t,f=r,l=i,u=s,{KILL:(I=o).BRUTAL_CRIT*u.DOUBLE_HIT+I.BRUTAL_CRIT*u.ARMOR_AND_HIT+I.CRIT*f.HIT,BRUTAL_HIT:I.BRUTAL_HIT*l.DOUBLE_HIT,HIT:I.HIT*a.HIT+I.BRUTAL_HIT*l.HIT,HIT_AND_ARMOR_BREAK:I.BRUTAL_HIT*l.ARMOR_AND_HIT,ARMOR_BREAK:I.HIT*a.ARMOR+I.CRIT*f.ARMOR+I.BRUTAL_HIT*l.ARMOR,DOUBLE_ARMOR_BREAK:I.BRUTAL_HIT*l.DOUBLE_ARMOR+I.BRUTAL_CRIT*u.DOUBLE_ARMOR,MISS:I.MISS+I.HIT*a.COVER+I.BRUTAL_HIT*l.COVER};var I,a,f,l,u})(n):(n=>{const o=c(n),t=R(n),r=n.cover?R(e(n,{cover:!1})):t;return T=t,s=r,{KILL:(i=o).CRIT*s.HIT,HIT:i.HIT*T.HIT,ARMOR_BREAK:i.HIT*T.ARMOR+i.CRIT*s.ARMOR,MISS:i.MISS+i.HIT*T.COVER};var i,T,s})(n);onmessage=function(e){console.log("Beginning calculation..."),console.log(e.data);const n=Date.now(),o=s(e.data),t=Date.now();console.log("Finished calculation in ".concat(t-n,"ms")),postMessage(o)}})();
//# sourceMappingURL=479.5d37a429.chunk.js.map